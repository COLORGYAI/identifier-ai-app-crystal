<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>COLORGY AI Crystal Identifier</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">

<style>
body{
margin:0;
font-family:system-ui;
background:#0f172a;
color:white;
text-align:center;
}

header{
padding:30px 20px;
font-size:32px;
font-weight:800;
letter-spacing:1px;
}

#camera{
width:92%;
max-width:420px;
border-radius:18px;
margin-top:10px;
background:black;
}

button{
background:#6366f1;
border:none;
padding:14px 22px;
margin:10px;
border-radius:14px;
color:white;
font-size:16px;
font-weight:600;
cursor:pointer;
}

button:active{transform:scale(.96)}

#result{
margin:20px;
padding:18px;
background:#020617;
border-radius:18px;
min-height:120px;
line-height:1.5;
}

.install{
background:#10b981;
display:none;
}
</style>

</head>

<body>

<header>ðŸ”® COLORGY AI SCAN</header>

<video id="camera" autoplay playsinline muted></video> <canvas id="canvas" style="display:none;"></canvas>

<div>
<button onclick="startCamera()">Start Camera</button>
<button onclick="capture()">Scan Crystal</button>
<button id="installBtn" class="install">Install App</button>
</div>

<div id="result">Point camera at crystal and press scan</div>

<script>
let stream;
let deferredPrompt;

// INSTALL PWA
window.addEventListener('beforeinstallprompt', e=>{
e.preventDefault();
deferredPrompt=e;
document.getElementById('installBtn').style.display='inline-block';
});

installBtn.onclick=()=>{
deferredPrompt.prompt();
}

// START CAMERA
async function startCamera(){
try{
stream=await navigator.mediaDevices.getUserMedia({
video:{facingMode:"environment"},
audio:false
});
document.getElementById("camera").srcObject=stream;
}catch(e){
alert("Camera permission required");
console.log(e);
}
}

// CAPTURE IMAGE
function capture(){
const video=document.getElementById("camera");
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

canvas.width=video.videoWidth;
canvas.height=video.videoHeight;
ctx.drawImage(video,0,0);

const image=canvas.toDataURL("image/jpeg",0.8);
analyze(image);
}

// ANALYZE IMAGE (OPENAI VISION)
async function analyze(base64){

document.getElementById("result").innerHTML="Analyzing crystal...";

const response=await fetch("https://api.openai.com/v1/chat/completions",{
method:"POST",
headers:{
"Content-Type":"application/json",
"Authorization":"Bearer YOUR_API_KEY_HERE"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
},
body:JSON.stringify({
model:"gpt-4o-mini",
messages:[
{
role:"user",
content:[
{type:"text",text:"Identify this crystal and give meaning, chakra, and properties"},
{type:"image_url",image_url:{url:base64}}
]
}
],
max_tokens:300
})
});

const data=await response.json();
document.getElementById("result").innerHTML=data.choices[0].message.content;
}
</script>

</body>
</html>
